// Kademlia Protocol messages
syntax = "proto3";
package kadproto;

service Kademlia {
    rpc Ping(PingM) returns (PingM) {}
    rpc Store(StoreReq) returns(StoreRepl) {}
    rpc Find_Node(FNodeReq) returns(FNodeRepl) {}
    rpc Find_Value(FValueReq) returns(FValueRepl) {}
}

message PingM {
    string cookie = 1; // "Magic cookie" used to track this exact ping request
    bytes id = 2;
}

message StoreReq {
    string cookie = 1;
    bytes my_id = 2;
    bytes key = 3;
    string value = 4;
}

message StoreRepl {
    string cookie = 1;
    bytes my_id = 2;
}

message FNodeReq {
    string cookie = 1;
    bytes my_id = 2;
    bytes uid = 3;
}

message FNodeRepl {
    string cookie = 1;
    bytes my_id = 2;
    repeated kcontact knode = 3;
}

message FValueReq {
   string cookie = 1;
   bytes my_id = 2;
   bytes uid = 3;
}

message FValueRepl {
    string cookie = 1;
    bytes my_id = 2;
    repeated kcontact node = 3;
    optional string value = 4;
}

message kcontact {
    bytes uid = 1;
    string ip = 2;
    int32 port = 3;
}